\label{sec:feeds}

The blockchain needs to be aware of a fair valuation of the token and its
collateral (think, the value of BTS in USD) in order to enable margin calls
(see below) and allow for settlements (see below) to convert tokens into the
collateral token at a fair price.

A feed constitutes multiple attributes including
\begin{description}
 \item[price] of the token with respect to the collateral of the smartcoin,
  e.g., the BTS price in USD.
 \item[maximum short squeeze ratio]: Given that margin calls are force to buy
  in the markets, this ratio defines the upper bound for the premium that needs
  to be paid in case of a margin call.
 \item[maintenance collateral ratio]: This parameter defines the minimum
  required collateral as a ratio between the token and the value of the
  collateral denoted in token. If the collateral ratio of any call order (a
  borrow position) comes below this ratio, a margin call for the call order is
  triggered.
\end{description}

These parameters are in the hands of the group selected by the owner of the
smartcoin. Only those are allowed to produce valid price feeds for a particular
smartcoin. In case of \emph{bitUSD}, \emph{bitCNY} and others, the owner of the
token is the committee, a group of people elected by the BTS holders. Here, the
group of feed producers coincides with the group of block producers (i.e.
\emph{witnesses})

These $N$ trusted witnesses can be constantly reviewed as all feeds are put on
the blockchain. Hence, misbehaving witnesses can be identified, fired from
their revenue generating witness position and lose their reputation.

In case of bitUSD and bitCNY, when feed producers generate their feed price,
they usually obtain a fair valuation by considering the exchange rates for the
smartcoin on multiple exchanges and trading platforms and combine them to
reflect a fair price. Most witnesses make use of volume-weighted averaging to
properly account for trading volume on individual exchanges.

Additionally, feed producers are recommended to keep track of external price
movements and update their price feed accordingly.

Additionally, to prevent manipulation of the price feed (and the other
parameters), $N$ witnesses have to be elected that can all produce their feeds
independently. Having a set of $N$ feeds $p_i,\;1<i<N$ for an arbitrary
smartcoin on the blockchain, the protocol obtains a value $\tilde{p}$ by the
use of the \emph{median} according to:
\begin{align}
 x &= \operatorname{sort}(p[i])\\
 \tilde p &=\begin{cases}
   x[\frac{N+1}{2}]                                               & N \text{ odd}\\
   \frac {1}{2}\left(x[{\frac{N}{2}}] + x[\frac{N}{2} + 1]\right) & N \text{ even.}
 \end{cases}
\end{align}
Hence, the price, as well as the other parameters, are resistant against
misbehaving witnesses in that only a \textbf{majority} of feed publishers can
manipulate the outcome of the median. In practice, any unintentional feed
\emph{error} is thus balanced around the median value.

Ultimately, we end up with a trusted and fair price for the smart coin at which
we can execute margin calls and settlements.
